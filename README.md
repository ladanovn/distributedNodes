## Использование
1. `npm run start` - запуск узла          
2. `npm run getErrors` - извлечение ошибочных сообщений

## Реализация
Каждый узел имеет внутренние состояние, в котором определены все запущенные приложения, определен, кто из них является генератором, а кто обработчиком.         
Периодически происходит синхронизация активных узлов. Для этого:        
1) Каждый узел подтвержает, что он находится онлайн, записывая в редис свой идентификатор и проставляя время.       
`set node:${this.id}:timestamp, ${Date.now});`      
2) На основании этих данных находятся дисконнектнившиеся узлы. Если они до этого являлись генератором или обработчиком, то происходит расчет новых претендентов на данные роли. Расчет происходит на основании идентификаторов каждого узла: если их отсортировать, то можно на всех узлах одназначно определить одного кандидата. 

## Как можно было бы еще решить данную задачу      
Синхронизация - вынужденная и неоптимальная мера, т.к. приходится синхронизироваться чаще, чем должна быть публикация сообщений (0.5s).     
Возможным вариантом было бы находить отключивщиеся узлы (и назначать новыена них роли) в момент прихода сообщения. Но возникает проблема отследить дисконнект генератора сообщений. Это возможно, некоторые брокеры сообщений поддерживают "last will and testament", но не Redis.

## Условие гонки            
Избегать условие гонки в условиях взаимодействия множества Node-процессов помогает одназначная трактовка очередности для каждого запущенного приложения.

Каждый узел имеет свой уникальный идентификатор. Кроме того, каждый узел знает идетификаторы всех запущенных узлов. Если генератор сообщений или их обработчик дисконнектнулся, то каждый узел высчитывает нового кандидата на вакатное место на основании отсортированного множества идентификаторов активных узлов. Т.е. 
```
if (!onlineNodeIds.has(generator)) {
    const orderedNodes = [...onlineNodeIds].sort();
    await this._setGlobalGenerator(orderedNodes[0]);
} 
```

## Демо
[![Watch the video](https://img.youtube.com/vi/FPtmXxBCstc/maxresdefault.jpg)](https://www.youtube.com/watch?v=FPtmXxBCstc)